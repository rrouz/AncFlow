Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 4
Rules claiming more threads will be scaled down.
Job stats:
job            count
-----------  -------
autophy_msa        1
total              1

Select jobs to execute...

[Sat Aug 26 13:29:26 2023]
rule autophy_msa:
    input: output/2023-08-25_treeOMPuniprotumapgmmemm.tree, aligned_protein_sequences.fasta
    output: autophy_msa.fasta
    jobid: 0
    reason: Missing output files: autophy_msa.fasta
    resources: tmpdir=/var/folders/6w/cbbj2d4d1cs82bbv3lr2jt700000gn/T

[Sat Aug 26 13:29:28 2023]
Error in rule autophy_msa:
    jobid: 0
    input: output/2023-08-25_treeOMPuniprotumapgmmemm.tree, aligned_protein_sequences.fasta
    output: autophy_msa.fasta
    shell:
        
        pip install biopython
        from Bio import Phylo, SeqIO
        import difflib

        tree_file_path = "output/2023-08-25_treeOMPuniprotumapgmmemm.tree"
        tree = Phylo.read(tree_file_path, "newick")
        taxon_names = [clade.name for clade in tree.get_terminals()]

        msa_file_path = "aligned_protein_sequences.fasta"
        msa_records = list(SeqIO.parse(msa_file_path, "fasta"))

        for record in msa_records:
            best_match = difflib.get_close_matches(record.id, taxon_names, n=1)
            if best_match:
                record.id = best_match[0]
                record.description = ""

        output_msa_path = "autophy_msa.fasta"
        with open(output_msa_path, "w") as output_handle:
            SeqIO.write(msa_records, output_handle, "fasta")
        
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: .snakemake/log/2023-08-26T132926.002506.snakemake.log
